"use strict";!function(t){angular.module("pw.canvas-painter",[]),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/canvas.html",'<div class="pwCanvasPaint" style="position:relative"><canvas id="pwCanvasMain"></canvas><canvas id="pwCanvasTmp" style="position:absolute;top:0;left:0"></canvas></div>')}])}(),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/color-selector.html",'<ul class="pwColorSelector"><li ng-repeat="color in colorList track by $index" class="pwColor" ng-class="{\'active\': (selectedColor === color)}" style="background-color: {{color}}" ng-click="setColor(color)"></li></ul>')}])}(),angular.module("pw.canvas-painter").directive("pwCanvas",function(){return{restrict:"AE",scope:{options:"="},templateUrl:"../templates/canvas.html",link:function(e){var o=!!("ontouchstart"in t),n=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,a=o?"touchstart":"mousedown",i=o?"touchmove":"mousemove",l=o?"touchend":"mouseup",r=e.options;r.width=r.width||400,r.height=r.height||300,r.backgroundColor=r.backgroundColor||"#fff",r.color=r.color||"#000",r.undoEnabled=r.undoEnabled||!1,r.opacity=r.opacity||.9,r.lineWidth=r.lineWidth||1;var c=document.getElementById("pwCanvasMain"),s=document.getElementById("pwCanvasTmp"),u=c.getContext("2d"),d=s.getContext("2d"),h={x:0,y:0},p=[];c.width=s.width=r.width,c.height=s.height=r.height,u.fillStyle=r.backgroundColor,u.fillRect(0,0,c.width,c.height),d.globalAlpha=r.opacity,d.lineJoin=d.lineCap="round",d.lineWidth=10,d.strokeStyle=r.color,e.$watch("options.lineWidth",function(t){"string"==typeof t&&(t=parseInt(t,10)),t&&"number"==typeof t&&(d.lineWidth=r.lineWidth=t)}),e.$watch("options.color",function(t){t&&(d.strokeStyle=d.fillStyle=t)}),e.$watch("options.opacity",function(t){t&&(d.globalAlpha=t)});var f=function(t,e){o?n?(t.x=e.layerX,t.y=e.layerY):(t.x=e.changedTouches[0].clientX-e.target.offsetParent.offsetLeft,t.y=e.changedTouches[0].clientY-e.target.offsetParent.offsetTop):(t.x=void 0!==e.offsetX?e.offsetX:e.layerX,t.y=void 0!==e.offsetY?e.offsetY:e.layerY)},v=function(t){if(t&&(t.preventDefault(),f(h,t)),p.push({x:h.x,y:h.y}),3===p.length){var e=p[0];return d.beginPath(),d.arc(e.x,e.y,d.lineWidth/2,0,2*Math.PI,!0),d.fill(),d.closePath(),void 0}d.clearRect(0,0,s.width,s.height),d.beginPath(),d.moveTo(p[0].x,p[0].y);for(var o=1;o<p.length-2;o++){var n=(p[o].x+p[o+1].x)/2,a=(p[o].y+p[o+1].y)/2;d.quadraticCurveTo(p[o].x,p[o].y,n,a)}d.quadraticCurveTo(p[o].x,p[o].y,p[o+1].x,p[o+1].y),d.stroke()},g=function(){o||t.addEventListener(l,function(){s.removeEventListener(i,v,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1),s.addEventListener(a,function(t){t.preventDefault(),s.addEventListener(i,v,!1),f(h,t),p.push({x:h.x,y:h.y}),p.push({x:h.x,y:h.y}),v()},!1),s.addEventListener(l,function(){s.removeEventListener(i,v,!1),u.drawImage(s,0,0),d.clearRect(0,0,s.width,s.height),p=[]},!1)};g()}}}),angular.module("pw.canvas-painter").directive("pwColorSelector",function(){return{restrict:"AE",scope:{colorList:"=pwColorSelector",selectedColor:"=color"},templateUrl:"../templates/color-selector.html",link:function(t){t.setColor=function(e){t.selectedColor=e}}}})}(this);